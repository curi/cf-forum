<% use_anchor ||= false %>
<% prefix_anchor ||= false %>
<% if prefix_anchor %>
  <%= link_to "#", "##{node.id}" %> |
<% end %>
<%= link_to use_anchor ? "##{node.id}" : node_path(node) do %>
  <%= node.id %>: <%= node.title_w_default %>
<% end %>
<% if node.n_children > 0 %>
  <% if max_depth > 0 %>
    <ul>
      <% node.children(current_user).each do |n2| %>
        <li>
          <%= render 'subtree_draw', node: n2, max_depth: max_depth - 1, use_anchor: use_anchor, prefix_anchor: prefix_anchor %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <ul>
      <li>... <%= node.n_children %> children, <%= node.n_descendants %> descendants</li>
    </ul>
  <% end %>
<% end %>
