<div class="columns mt-6 is-centered">
  <div class="column">
    <nav class="panel">
      <div class="panel-heading has-background-primary-light is-flex">
        <div class="is-flex-grow-5">
          <%= @node.content&.title %>
          <%= link_to "../", node.parent, class: "is-small" %>
        </div>
        <div class="">
          <% if current_user && node.user.id == current_user.id %>
            <%= link_to 'Edit', edit_node_path(@node), class: "button is-small" %>
          <% end %>
          <%= link_to 'Reply', reply_to_node_path(:parent_id => @node.id), class: "button is-success is-small" %>
        </div>
      </div>
      <div class="panel-block">
        <%= @node.content.body %>
      </div>
      <!-- <p class="panel-tabs has-text-left is-flex pl-1">
        <%# <%= link_to 'Delete', node_path(@node), class: "button is-warning", method: :delete, data: { confirm: "Are you sure?" } %>
        <span class="is-flex-grow-4"></span>
      </p> -->
      <div class="panel-block">
        <nav class="breadcrumb">
          <ul>
            <li><%= link_to node.author.formatted_name, node.author %></li>
            <li><%= link_to node.user.username, node.user %></li>
            <li class="is-active">
              <a><%= node.created_at %> / <%= time_ago_in_words(node.created_at || DateTime.now) %> ago</a>
            </li>
            <li class="is-active">
              <a>Children: <%= node.children(@user).count %></a>
            </li>
            <li class="is-active">
              <a>Descendants: <%= node.descendants(@user).count %></a>
            </li>
          </ul>
        </nav>
      </div>
    </nav>
  </div>
</div>
<% if @node.children(@user).length > 0 %>
  <h3 class='title'>Replies:</h3>
  <h5 class='subtitle'>TOC:</h5>
  <%= render 'subtree_full', node: @node, use_anchor: true %>
  <% @node.children(@user).each do |r| %>
    <div>
      todo: is this recursive?
    </div>
    <%= render 'view_comment_inline', node: r %>
  <% end %>
<% else %>
  <h5 class='is-size-5'>No Comments.</h5>
<% end %>
